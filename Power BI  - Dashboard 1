‚ö™ CONEX√ÉO COM Base DE ARQUIVO XLS

= Table.TransformColumnTypes(#"Cabe√ßalhos Promovidos",{{"ID", Int64.Type}, {"PROTOCOLO", Int64.Type}, {"DATA DO ATENDIMENTO", type date}, {"TIPO CLIENTE", type text}, {"CANAL", type text}, {"NOME", type any}, {"CPF", type any}, {"TELEFONE 1", type any}, {"TELEFONE 2", type any}, {"E-mail", type any}, {"LOGRADOURO", type any}, {"COMPLEMENTO", type any}, {"BAIRRO", type any}, {"CIDADE", type text}, {"UF", type text}, {"CEP", type any}, {"REFERENCIA", type any}, {"SKU", type text}, {"EAN", type text}, {"PRODUTO", type text}, {"MARCA", type text}, {"FAMILIA", type text}, {"CATEGORIA", type text}, {"DESCRI√á√ÉO", type text}, {"GRUPO", type text}, {"VALIDADE1", type text}, {"MANIFESTA√á√ÉO", type text}, {"TIPO", type text}, {"MOTIVO", type text}, {"NATUREZA", type text}, {"LOTE", type text}, {"FABRICA√á√ÉO", type text}, {"VALIDADE", type text}, {"QTDE RECLAMADA", Int64.Type}, {"QTDE RECOLHIDA", type any}, {"QTDE RESSARCIDA", type any}, {"DATA DA COMPRA", type text}, {"LOCAL COMPRA", type text}, {"Bairro / UF", type text}, {"Descri√ß√£o -  Narrativa do Consumidor", type text}, {"A√á√ÉO DO SAC", type text}, {"ANALISE", type text}, {"Criticidade / Gravidade", type text}, {"Estado de √¢nimo", type text}, {"FOTOS", type text}, {"Finalidade amostra", type text}, {"TRANSPORTADORA", type text}, {"STATUS", type text}, {"SOLU√á√ÉO", type text}, {"LGPD", type text}})

-------------------------------------------------------------------------------------------
‚ö™ CRIANDO TABELA TBL_CALENDARIO

TBL_Calendario = CALENDAR(MIN(Base[DATA DO ATENDIMENTO]); MAX(Base[DATA DO ATENDIMENTO]))

COLUNAS:

Mm = MONTH(TBL_Calendario[Date])

Mmm = EOMONTH(TBL_Calendario[Date];0)

Ano = YEAR(TBL_Calendario[Date])

AnoMes = YEAR(TBL_Calendario[Date])&FORMAT(MONTH(TBL_Calendario[Date]);"00")

FY = 
var maior = TOPN(1;ALLSELECTED(TBL_Calendario[AnoMes]))
var mes = LOOKUPVALUE(TBL_Calendario[Mm];TBL_Calendario[AnoMes];maior)
RETURN IF(TBL_Calendario[Ano] = MAX(TBL_Calendario[Ano]); "YTD")

Refer√™ncia = if(TBL_Calendario[AnoMes] = MAX(TBL_Calendario[AnoMes]); "Mes atual")

-------------------------------------------------------------------------------------------

‚ö™ CONFIGURANDO TABELA CALEND√ÅRIO COMO TABELA DE DATA

ARQUIVO > OP√á√ïES E CONFIGURA√á√ïES > OP√á√ïES > Intelig√™ncia de dados Temporais: Desativado

-- Power Bi para de detectar datas autom√°ticamente e aplicar padr√µes temporais autom√°ticamente.

Dados > Calendario > ... > Marcar como tabela de data

---------------------------------------------------------------------------------------------

‚ö™ CRIANDO RELACIONOAMENTO ENTRE TABELAS

Exibi√ß√£o do modelo > Gerenciar Rela√ß√µes > Novo... TBL_Calendario Date ü§ù BASE (Data do atendimento)

CARDINALIDADE: Muitos para um (*:1)

DIRE√á√ÉO DO FILTRO CRUZADI: √önico

---------------------------------------------------------------------------------------------

‚ö™ CRIANDO MEDIDAS

Contanterior = CALCULATE(COUNT(Base[PROTOCOLO]); TBL_Calendario[AnoMes] = FORMAT(EOMONTH(MAX(TBL_Calendario[Date]); -1);"yyyymm"))

----------------------

Contmes = --CALCULATE(
                    --COUNTROWS('DB');
                                    --TBL_Calendario[Refer√™ncia] = "Mes atual")

VAR ANOMES = MAX(TBL_Calendario[AnoMes])

 RETURN CALCULATE(
                    COUNTROWS('Base');
                                    TBL_Calendario[AnoMes] = ANOMES)

----------------------

LYTD Cont = var primdia = EOMONTH(MAX(TBL_Calendario[Date]);-2)
var ultimodia = EOMONTH(MAX(TBL_Calendario[Date]);-1)
RETURN CALCULATE(COUNTROWS(Base); SAMEPERIODLASTYEAR(TBL_Calendario[Date])) --CALCULATE(COUNTROWS('DB'); TBL_Calendario[Date] > primdia && TBL_Calendario[Date] < ultimodia)

----------------------

LYTD QTD = var primdia = EOMONTH(MAX(TBL_Calendario[Date]);-2)
var ultimodia = EOMONTH(MAX(TBL_Calendario[Date]);-1)
RETURN CALCULATE(SUM(Base[QTDE RECLAMADA]); SAMEPERIODLASTYEAR(TBL_Calendario[Date])) --CALCULATE(COUNTROWS('DB'); TBL_Calendario[Date] > primdia && TBL_Calendario[Date] < ultimodia)

----------------------

QTDanterior = CALCULATE(SUM(Base[QTDE RECLAMADA]); TBL_Calendario[AnoMes] = FORMAT(EOMONTH(MAX(TBL_Calendario[Date]); -1);"yyyymm"))

----------------------

QTDmes = --CALCULATE(
                    --COUNTROWS('DB');
                                    --TBL_Calendario[Refer√™ncia] = "Mes atual")

VAR ANOMES = MAX(TBL_Calendario[AnoMes])

 RETURN CALCULATE(
                    SUM(Base[QTDE RECLAMADA]);
                                    TBL_Calendario[AnoMes] = ANOMES)
---------------------

T√≠tulo = IF(SELECTEDVALUE('Sele√ß√£o'[Op√ß√£o]) = "YTD";
            "DASHBOARD YTD - " & UPPER(FORMAT(MIN(TBL_Calendario[Date]);"mmm")) & " a " & UPPER(FORMAT(MAX(TBL_Calendario[Date]);"mmm yy"));            
            "DASHBOARD - " & UPPER(FORMAT(MAX(TBL_Calendario[Date]);"MMMM YY")))

---------------------

Titulo card 1 = IF(SELECTEDVALUE('Sele√ß√£o'[Op√ß√£o]) = "YTD";
                    "Protocolos YTD ";
                       "Protocolos " & FORMAT(MAX(TBL_Calendario[Date]);"mmm yy"))

--------------------

Titulo card 2 = "Varia√ß√£o"

--------------------

Titulo card 3 = IF(SELECTEDVALUE('Sele√ß√£o'[Op√ß√£o]) = "YTD";
                    "QTD YTD ";
                       "QTD " & FORMAT(MAX(TBL_Calendario[Date]);"mmm yy"))

-------------------

Varia√ß√£o cont mes = DIVIDE([Contmes]-[Contanterior]; [Contanterior])

-------------------

Varia√ß√£o cont YTD = DIVIDE([YTD cont]-[LYTD Cont]; [LYTD Cont])

------------------

Varia√ß√£o QTD mes = DIVIDE([QTDmes]-[QTDanterior]; [QTDanterior])

------------------

Varia√ß√£o QTD YTD = DIVIDE([YTD QTD]-[LYTD QTD]; [LYTD QTD])

------------------

YTD cont = CALCULATE(
                COUNTROWS(Base);
                                TBL_Calendario[FY] = "YTD")

------------------

YTD QTD = CALCULATE(
                SUM(Base[QTDE RECLAMADA]);
                                TBL_Calendario[FY] = "YTD")

---------------------------------------------------------------------------------------------

‚ö™ ORGANIZANDO MEDIDAS

EXIBI√á√ÉO DO MODELO > MEDIDA > PROPRIEDADES > Pasta de exibi√ß√£o: Medidas DAX

---------------------------------------------------------------------------------------------

‚ö™ CRIA√á√ÉO DE PAR√ÇMETROS

Cont YTD x MES = {
    ("Protocolos YTD"; NAMEOF('Base'[YTD cont]); 0);
    ("Protocolos M√™s"; NAMEOF('Base'[Contmes]); 1)
}

Grupos x Categoria = {
    ("GRUPOS"; NAMEOF('Base'[GRUPO]); 0);
    ("CATEGORIAS"; NAMEOF('Base'[CATEGORIA]); 1);
    ("FAMILIAS"; NAMEOF('Base'[FAMILIA]); 2)
}

Lotes x Motivos X Naturezas = {
    ("MOTIVOS"; NAMEOF('Base'[MOTIVO]); 0);
    ("NATUREZAS"; NAMEOF('Base'[NATUREZA]); 1)
}

Marcas x Produtos = {
    ("MARCA"; NAMEOF('Base'[MARCA]); 0);
    ("PRODUTO"; NAMEOF('Base'[PRODUTO]); 1)
}

QTD YTD x Mes = {
    ("QTD YTD"; NAMEOF('Base'[YTD QTD]); 0);
    ("QTD M√™s"; NAMEOF('Base'[QTDmes]); 1)
}

TBL_Calendario = CALENDAR(MIN(Base[DATA DO ATENDIMENTO]); MAX(Base[DATA DO ATENDIMENTO]))

VAR Cont YTD x Mes = {
    ("Varia√ß√£o cont YTD"; NAMEOF('Base'[Varia√ß√£o cont YTD]); 0);
    ("Varia√ß√£o cont mes"; NAMEOF('Base'[Varia√ß√£o cont mes]); 1)
}

VAR QTD YTD x Mes = {
    ("Varia√ß√£o QTD YTD"; NAMEOF('Base'[Varia√ß√£o QTD YTD]); 0);
    ("Varia√ß√£o QTD mes"; NAMEOF('Base'[Varia√ß√£o QTD mes]); 1)
}

--------------------------------------------------------------------------------------------

‚ö™ CRIANDO TABELA PARA SELE√á√ÉO DE MODELO DE AN√ÅLISE ANUAL X MENSAL

P√ÅGINA INICIAL > DADOS > INSERIR DADOS

COLUNA 1 = OP√á√ÉO (YTD, MES)
COLUNA 2 = CAMPOS (0, 1)

EXIBI√á√ÉO DE MODELO > GERENCIAR RELA√á√ïES: SELE√á√ÉO (OP√á√ÉO) ü§ù PARAMETROS (SELE√á√ÉO)

AGORA TODAS √îS PAR√ÇMETROS S√ÉO DEFINIDOS PELEA SELE√á√ÉO DESSA TABELA, E UM TOGGLE COM AS OP√á√ïES YTD X MES, FILTRAM TODO O DASHBOARD, ALTERNANDO A AN√ÅLISE DE ANUAL PARA MENSAL CONFORME NECESSIDADE DO USU√ÅRIO FINAL.
